name: Create React Native App

on:
  workflow_dispatch: # Triggered manually from the GitHub Actions tab

jobs:
  create-rn-app:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install React Native CLI
        run: npm install -g @react-native-community/cli

      - name: Scaffold React Native app
        run: |
          npx @react-native-community/cli init AudioSchedulerApp \
            --directory AudioSchedulerApp \
            --skip-install

      - name: Install app dependencies
        working-directory: AudioSchedulerApp
        run: npm install

      - name: Create project structure folders
        run: |
          mkdir -p AudioSchedulerApp/src/assets
          mkdir -p AudioSchedulerApp/src/components
          mkdir -p AudioSchedulerApp/src/utils

      - name: Create schedule.json placeholder
        run: |
          cat > AudioSchedulerApp/src/assets/schedule.json << 'EOF'
          [
            {
              "id": "1",
              "label": "Morning Alert",
              "date": "2025-01-01",
              "time": "08:00:00"
            },
            {
              "id": "2",
              "label": "Afternoon Alert",
              "date": "2025-01-01",
              "time": "14:00:00"
            }
          ]
          EOF

      - name: Create audio placeholder README
        run: |
          cat > AudioSchedulerApp/src/assets/AUDIO_README.md << 'EOF'
          # Audio File

          Place your `audio.mp3` file in this directory: `src/assets/audio.mp3`

          This file will be played when a scheduled time in `schedule.json` is reached.
          EOF

      - name: Create .gitignore for the RN app
        run: |
          cat > AudioSchedulerApp/.gitignore << 'EOF'
          # OSX
          .DS_Store

          # Xcode
          build/
          *.pbxuser
          !default.pbxuser
          *.mode1v3
          !default.mode1v3
          *.mode2v3
          !default.mode2v3
          *.perspectivev3
          !default.perspectivev3
          xcuserdata
          *.xccheckout
          *.moved-to-trash
          DerivedData
          *.hmap
          *.ipa
          *.xcuserstate
          ios/.xcode.env.local

          # Android/IntelliJ
          build/
          .idea
          .gradle
          local.properties
          *.iml
          *.hprof
          .cxx
          *.keystore
          !debug.keystore

          # node.js
          node_modules/
          npm-debug.log
          yarn-error.log

          # Temporary files created by Metro
          .metro-health-check*

          # Testing
          coverage/

          # Yarn
          .yarn/cache
          .yarn/unplugged
          .yarn/build-state.yml
          .yarn/install-state.gz
          .pnp.*
          EOF

      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Commit and push React Native app
        run: |
          git add AudioSchedulerApp/
          git status
          git commit -m "feat: scaffold React Native AudioSchedulerApp with project structure"
          git push